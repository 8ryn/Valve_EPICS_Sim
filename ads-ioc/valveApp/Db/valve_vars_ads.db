#! Generated by VisualDCT v2.8.3
#! DBDSTART
#! DBDEND


record(bo, "$(P):OpenCommand") {
  field(DESC, "Command to open valve")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn($(PORT) 0 0) BOOL W P=$(ADS_PORT) V=Valve.open")
  field(ZNAM, "Zero")
  field(ONAM, "One")
  field(FLNK, "$(P):SetOpenBusy")
}

record(calcout, "$(P):SetOpenBusy") {
  field(INPA, "$(P):OpenSwitch NPP")
#Doesn't set busy record if already open
  field(CALC, "!A")
  field(OOPT, "When Non-zero")
  field(OUT, "$(P):OpenBusy PP")
}

record(busy, "$(P):OpenBusy") {
}

record(calcout, "$(P):ClearOpenBusy") {
  field(INPA, "$(P):OpenSwitch CP")
  field(CALC, "!A")
  field(OOPT, "Transition To Zero")
  field(OUT, "$(P):OpenBusy PP")
}

record(bo, "$(P):CloseCommand") {
  field(DESC, "Command to close valve")
  field(DTYP, "asynInt32")
  field(OUT, "@asyn($(PORT) 0 0) BOOL W P=$(ADS_PORT) V=Valve.close")
  field(ZNAM, "Zero")
  field(ONAM, "One")
}

record(calcout, "$(P):SetCloseBusy") {
  field(INPA, "$(P):ClosedSwitch NPP")
#Doesn't set busy record if already closed
  field(CALC, "!A")
  field(OOPT, "When Non-zero")
  field(OUT, "$(P):CloseBusy PP")
}

record(busy, "$(P):CloseBusy") {
}

record(calcout, "$(P):ClearCloseBusy") {
  field(INPA, "$(P):ClosedSwitch CP")
  field(CALC, "!A")
  field(OOPT, "Transition To Zero")
  field(OUT, "$(P):CloseBusy PP")
}

record(bi, "$(P):OpenSwitch") {
  field(DESC, "Whether valve is open")
  field(DTYP, "asynInt32")
  field(SCAN, "I/O Intr")
  field(INP, "@asyn($(PORT) 0 0) BOOL R P=$(ADS_PORT) V=Valve.open_switch")
  field(ZNAM, "No")
  field(ONAM, "Yes")
  field(FLNK, "$(P):OpenFan")
}

record(bi, "$(P):ClosedSwitch") {
  field(DESC, "Whether valve is closed")
  field(DTYP, "asynInt32")
  field(SCAN, "I/O Intr")
  field(INP, "@asyn($(PORT) 0 0) BOOL R P=$(ADS_PORT) V=Valve.closed_switch")
  field(ZNAM, "No")
  field(ONAM, "Yes")
}

record(bi, "$(P):Interlock") {
  field(DESC, "Whether valve is interlocked")
  field(DTYP, "asynInt32")
  field(SCAN, "I/O Intr")
  field(INP, "@asyn($(PORT) 0 0) BOOL R P=$(ADS_PORT) V=Valve.interlock")
  field(ZNAM, "Open")
  field(ONAM, "Locked")
}

record(ai, "$(P):Pressure_RBV") {
  field(DESC, "Valve pressure readback")
  field(PREC, "2")
  field(DTYP, "asynFloat64")
  field(SCAN, "I/O Intr")
  field(INP, "@asyn($(PORT) 0 0) LREAL R P=$(ADS_PORT) V=Valve.pressure")
}

record(ao, "$(P):Pressure") {
  field(DESC, "Valve pressure")
  field(PREC, "2")
  field(DTYP, "asynFloat64")
  field(OUT, "@asyn($(PORT) 0 0) LREAL W P=$(ADS_PORT) V=Valve.pressure")
}

record(stringin, "$(P):State") {
  field(DESC, "Valve state")
  field(DTYP, "asynOctetRead")
  field(SCAN, "I/O Intr")
  field(INP, "@asyn($(PORT) 0 0) STRING N=9 R P=$(ADS_PORT) V=Valve.state")
}

record(mbbiDirect, "$(P):Status") {
  field(DESC, "16 Bit word describing status of valve")
  field(DTYP, "asynUInt32Digital")
  field(SCAN, "I/O Intr")
  field(INP, "@asynMask($(PORT) 0 0xFFFF 0) UINT_digi R P=$(ADS_PORT) V=Valve.status")
}

record(bi, "$(P):TransitionError") {
  field(DESC, "Valve has been unable to transition")
  field(DTYP, "asynInt32")
  field(SCAN, "I/O Intr")
  field(INP, "@asyn($(PORT) 0 0) BOOL R P=$(ADS_PORT) V=Valve.transition_error")
  field(ZNAM, "No Error")
  field(ONAM, "Error")
  field(OSV, "MAJOR")
}

record(calc, "$(P):CycleCounter") {
  field(DESC, "Increments each time valve opens")
  field(SCAN, "Passive")
  field(CALC, "A+1")
  field(INPA, "$(P):CycleCounter NPP")
  field(PINI, "NO")
}

record(calcout, "$(P):CounterIncrementer") {
  field(INPA, "$(P):OpenSwitch PP")
  field(CALC, "!A")
  field(OOPT, "Transition To Zero")
  field(OUT, "$(P):CycleCounter.PROC PP")
}

record(fanout, "$(P):OpenFan") {
  field(FLNK, "$(P):CounterIncrementer")
  field(LNK0, "$(P):DetectValveOpen")
  field(LNK1, "$(P):DetectValveClose")
}

record(calcout, "$(P):DetectValveOpen") {
  field(CALC, "A")
  field(INPA, "$(P):OpenSwitch PP")
  field(OUT, "$(P):OpenTimestamp.PROC PP")
  field(OOPT, "Transition To Non-zero")
}


record(calcout, "$(P):DetectValveClose") {
  field(CALC, "A")
  field(INPA, "$(P):OpenSwitch PP")
  field(OUT, "$(P):CloseTimestamp.PROC PP")
  field(OOPT, "Transition To Zero")
}

record(ai, "$(P):OpenTimestamp") {
  field(DESC, "Timestamp when valve was opened")
  field(TSEL, "$(P):OpenSwitch.TIME")
  field(DTYP, "Soft Timestamp")
  field(PREC, "0")
  field(EGU, "s")
}


record(ai, "$(P):CloseTimestamp") {
  field(DESC, "Timestamp when valve was closed")
  field(TSEL, "$(P):OpenSwitch.TIME")
  field(DTYP, "Soft Timestamp")
  field(FLNK, "$(P):OpenTime")
  field(PREC, "0")
  field(EGU, "s")
}

record(calcout, "$(P):OpenTime") {
  field(CALC, "B-A")
  field(INPA, "$(P):OpenTimestamp")
  field(INPB, "$(P):CloseTimestamp")
  field(OUT, "$(P):OpenTimeTotal.B PP")
}

record(calcout, "$(P):OpenTimeTotal") {
  field(CALC, "B+A")
  field(INPA, "$(P):OpenTimeTotal")
}

#! Further lines contain data used by VisualDCT
#! View(1681,1071,1.7)
#! Record("$(P):OpenCommand",360,139,0,0,"$(P):OpenCommand")
#! Field("$(P):OpenCommand.FLNK",16777215,0,"$(P):OpenCommand.FLNK")
#! Link("$(P):OpenCommand.FLNK","$(P):SetOpenBusy")
#! Record("$(P):SetOpenBusy",80,227,0,1,"$(P):SetOpenBusy")
#! Field("$(P):SetOpenBusy.INPA",16777215,1,"$(P):SetOpenBusy.INPA")
#! Link("$(P):SetOpenBusy.INPA","$(P):OpenSwitch.VAL")
#! Field("$(P):SetOpenBusy.OUT",16777215,1,"$(P):SetOpenBusy.OUT")
#! Link("$(P):SetOpenBusy.OUT","$(P):OpenBusy.VAL")
#! Record("$(P):OpenBusy",420,483,0,0,"$(P):OpenBusy")
#! Field("$(P):OpenBusy.VAL",16777215,1,"$(P):OpenBusy.VAL")
#! Record("$(P):ClearOpenBusy",740,407,0,0,"$(P):ClearOpenBusy")
#! Field("$(P):ClearOpenBusy.INPA",16777215,1,"$(P):ClearOpenBusy.INPA")
#! Link("$(P):ClearOpenBusy.INPA","$(P):OpenSwitch.VAL")
#! Field("$(P):ClearOpenBusy.OUT",16777215,0,"$(P):ClearOpenBusy.OUT")
#! Link("$(P):ClearOpenBusy.OUT","$(P):OpenBusy.VAL")
#! Record("$(P):CloseCommand",660,33,0,0,"$(P):CloseCommand")
#! Record("$(P):SetCloseBusy",900,47,0,0,"$(P):SetCloseBusy")
#! Field("$(P):SetCloseBusy.INPA",16777215,1,"$(P):SetCloseBusy.INPA")
#! Link("$(P):SetCloseBusy.INPA","$(P):ClosedSwitch.VAL")
#! Field("$(P):SetCloseBusy.OUT",16777215,1,"$(P):SetCloseBusy.OUT")
#! Link("$(P):SetCloseBusy.OUT","$(P):CloseBusy.VAL")
#! Record("$(P):CloseBusy",1220,303,0,0,"$(P):CloseBusy")
#! Field("$(P):CloseBusy.VAL",16777215,1,"$(P):CloseBusy.VAL")
#! Record("$(P):ClearCloseBusy",1500,227,0,0,"$(P):ClearCloseBusy")
#! Field("$(P):ClearCloseBusy.INPA",16777215,1,"$(P):ClearCloseBusy.INPA")
#! Link("$(P):ClearCloseBusy.INPA","$(P):ClosedSwitch.VAL")
#! Field("$(P):ClearCloseBusy.OUT",16777215,0,"$(P):ClearCloseBusy.OUT")
#! Link("$(P):ClearCloseBusy.OUT","$(P):CloseBusy.VAL")
#! Record("$(P):OpenSwitch",1160,525,0,0,"$(P):OpenSwitch")
#! Field("$(P):OpenSwitch.FLNK",16777215,1,"$(P):OpenSwitch.FLNK")
#! Link("$(P):OpenSwitch.FLNK","$(P):OpenFan")
#! Field("$(P):OpenSwitch.VAL",16777215,1,"$(P):OpenSwitch.VAL")
#! Field("$(P):OpenSwitch.TIME",16777215,1,"$(P):OpenSwitch.TIME")
#! Record("$(P):ClosedSwitch",1900,259,0,0,"$(P):ClosedSwitch")
#! Field("$(P):ClosedSwitch.VAL",16777215,0,"$(P):ClosedSwitch.VAL")
#! Record("$(P):Interlock",2180,239,0,0,"$(P):Interlock")
#! Record("$(P):Pressure_RBV",2400,253,0,0,"$(P):Pressure_RBV")
#! Record("$(P):Pressure",2600,267,0,0,"$(P):Pressure")
#! Record("$(P):State",2200,427,0,0,"$(P):State")
#! Record("$(P):Status",2400,427,0,0,"$(P):Status")
#! Record("$(P):TransitionError",2600,425,0,0,"$(P):TransitionError")
#! Record("$(P):CycleCounter",1980,653,0,0,"$(P):CycleCounter")
#! Field("$(P):CycleCounter.VAL",16777215,0,"$(P):CycleCounter.VAL")
#! Field("$(P):CycleCounter.INPA",16777215,0,"$(P):CycleCounter.INPA")
#! Link("$(P):CycleCounter.INPA","$(P):CycleCounter.VAL")
#! Field("$(P):CycleCounter.PROC",16777215,0,"$(P):CycleCounter.PROC")
#! Record("$(P):CounterIncrementer",1700,687,0,0,"$(P):CounterIncrementer")
#! Field("$(P):CounterIncrementer.INPA",16777215,0,"$(P):CounterIncrementer.INPA")
#! Link("$(P):CounterIncrementer.INPA","$(P):OpenSwitch.VAL")
#! Field("$(P):CounterIncrementer.OUT",16777215,1,"$(P):CounterIncrementer.OUT")
#! Link("$(P):CounterIncrementer.OUT","$(P):CycleCounter.PROC")
#! Record("$(P):OpenFan",1420,641,0,0,"$(P):OpenFan")
#! Field("$(P):OpenFan.FLNK",16777215,1,"$(P):OpenFan.FLNK")
#! Link("$(P):OpenFan.FLNK","$(P):CounterIncrementer")
#! Field("$(P):OpenFan.LNK0",16777215,1,"$(P):OpenFan.LNK0")
#! Link("$(P):OpenFan.LNK0","$(P):DetectValveOpen")
#! Field("$(P):OpenFan.LNK1",16777215,1,"$(P):OpenFan.LNK1")
#! Link("$(P):OpenFan.LNK1","$(P):DetectValveClose")
#! Record("$(P):DetectValveOpen",1680,867,0,0,"$(P):DetectValveOpen")
#! Field("$(P):DetectValveOpen.INPA",16777215,0,"$(P):DetectValveOpen.INPA")
#! Link("$(P):DetectValveOpen.INPA","$(P):OpenSwitch.VAL")
#! Field("$(P):DetectValveOpen.OUT",16777215,1,"$(P):DetectValveOpen.OUT")
#! Link("$(P):DetectValveOpen.OUT","$(P):OpenTimestamp.PROC")
#! Record("$(P):DetectValveClose",1680,1087,0,0,"$(P):DetectValveClose")
#! Field("$(P):DetectValveClose.INPA",16777215,0,"$(P):DetectValveClose.INPA")
#! Link("$(P):DetectValveClose.INPA","$(P):OpenSwitch.VAL")
#! Field("$(P):DetectValveClose.OUT",16777215,1,"$(P):DetectValveClose.OUT")
#! Link("$(P):DetectValveClose.OUT","$(P):CloseTimestamp.PROC")
#! Record("$(P):OpenTimestamp",1980,873,0,1,"$(P):OpenTimestamp")
#! Field("$(P):OpenTimestamp.PROC",16777215,0,"$(P):OpenTimestamp.PROC")
#! Field("$(P):OpenTimestamp.TSEL",16777215,0,"$(P):OpenTimestamp.TSEL")
#! Link("$(P):OpenTimestamp.TSEL","$(P):OpenSwitch.TIME")
#! Field("$(P):OpenTimestamp.VAL",16777215,1,"$(P):OpenTimestamp.VAL")
#! Record("$(P):CloseTimestamp",1960,1079,0,1,"$(P):CloseTimestamp")
#! Field("$(P):CloseTimestamp.PROC",16777215,0,"$(P):CloseTimestamp.PROC")
#! Field("$(P):CloseTimestamp.FLNK",16777215,1,"$(P):CloseTimestamp.FLNK")
#! Link("$(P):CloseTimestamp.FLNK","$(P):OpenTime")
#! Field("$(P):CloseTimestamp.VAL",16777215,1,"$(P):CloseTimestamp.VAL")
#! Field("$(P):CloseTimestamp.TSEL",16777215,0,"$(P):CloseTimestamp.TSEL")
#! Link("$(P):CloseTimestamp.TSEL","$(P):OpenSwitch.TIME")
#! Record("$(P):OpenTime",2320,1187,0,0,"$(P):OpenTime")
#! Field("$(P):OpenTime.INPA",16777215,0,"$(P):OpenTime.INPA")
#! Link("$(P):OpenTime.INPA","$(P):OpenTimestamp.VAL")
#! Field("$(P):OpenTime.INPB",16777215,0,"$(P):OpenTime.INPB")
#! Link("$(P):OpenTime.INPB","$(P):CloseTimestamp.VAL")
#! Field("$(P):OpenTime.OUT",16777215,1,"$(P):OpenTime.OUT")
#! Link("$(P):OpenTime.OUT","$(P):OpenTimeTotal.B")
#! Record("$(P):OpenTimeTotal",2600,1215,0,1,"$(P):OpenTimeTotal")
#! Field("$(P):OpenTimeTotal.VAL",16777215,0,"$(P):OpenTimeTotal.VAL")
#! Field("$(P):OpenTimeTotal.INPA",16777215,0,"$(P):OpenTimeTotal.INPA")
#! Link("$(P):OpenTimeTotal.INPA","$(P):OpenTimeTotal.VAL")
#! Field("$(P):OpenTimeTotal.B",16777215,0,"$(P):OpenTimeTotal.B")
